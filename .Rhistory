setwd("~/Documents/jagust")
library(lme4)
library(coefplot2)
library(ggplot2)
library(lmerTest)
library(pbkrtest)
library(multcomp)
library(contrast)
library(xtable)
library(sjPlot)
# Import data for Ns
df_ef = read.csv('dpgmm_alpha15.37_bilateral_UW_EF__ALL_longdata_continuous.csv')
df_mem = read.csv('dpgmm_alpha15.37_bilateral_UW_MEM__ALL_longdata_continuous.csv')
df_adas = read.csv('dpgmm_alpha15.37_bilateral_ADAScog__ALL_longdata_continuous.csv')
df_avlt = read.csv('dpgmm_alpha15.37_bilateral_AVLT__ALL_longdata_continuous.csv')
df_wmh = read.csv('dpgmm_alpha15.37_bilateral_WMH_percentOfICV__ALL_longdata_continuous.csv')
df_av45 = read.csv('dpgmm_alpha15.37_bilateral_AV45_ALL_longdata_continuous.csv')
df_hcicv = read.csv('dpgmm_alpha15.37_bilateral_FSX_HC_ICV__ALL_longdata_continuous.csv')
df_ef$CORTICAL_SUMMARY_POSITIVE = factor(df_ef$CORTICAL_SUMMARY_POSITIVE)
df_mem$CORTICAL_SUMMARY_POSITIVE = factor(df_mem$CORTICAL_SUMMARY_POSITIVE)
df_adas$CORTICAL_SUMMARY_POSITIVE = factor(df_adas$CORTICAL_SUMMARY_POSITIVE)
df_avlt$CORTICAL_SUMMARY_POSITIVE = factor(df_avlt$CORTICAL_SUMMARY_POSITIVE)
df_wmh$CORTICAL_SUMMARY_POSITIVE = factor(df_wmh$CORTICAL_SUMMARY_POSITIVE)
df_av45$CORTICAL_SUMMARY_POSITIVE = factor(df_av45$CORTICAL_SUMMARY_POSITIVE)
df_hcicv$CORTICAL_SUMMARY_POSITIVE = factor(df_hcicv$CORTICAL_SUMMARY_POSITIVE)
df_ef$RID = factor(df_ef$RID)
df_mem$RID = factor(df_mem$RID)
df_adas$RID = factor(df_adas$RID)
df_avlt$RID = factor(df_avlt$RID)
df_wmh$RID = factor(df_wmh$RID)
df_av45$RID = factor(df_av45$RID)
df_hcicv$RID = factor(df_hcicv$RID)
df_ef$group = factor(df_ef$group)
df_mem$group = factor(df_mem$group)
df_adas$group = factor(df_adas$group)
df_avlt$group = factor(df_avlt$group)
df_av45$group = factor(df_av45$group)
df_wmh$group = factor(df_wmh$group)
df_hcicv$group = factor(df_hcicv$group)
df_ef$diag_prior = factor(df_ef$diag_prior)
df_mem$diag_prior = factor(df_mem$diag_prior)
df_adas$diag_prior = factor(df_adas$diag_prior)
df_avlt$diag_prior = factor(df_avlt$diag_prior)
df_wmh$diag_prior = factor(df_wmh$diag_prior)
df_av45$diag_prior = factor(df_av45$diag_prior)
df_hcicv$diag_prior = factor(df_hcicv$diag_prior)
df_ef$APOE4_BIN = factor(df_ef$APOE4_BIN)
df_mem$APOE4_BIN = factor(df_mem$APOE4_BIN)
df_adas$APOE4_BIN = factor(df_adas$APOE4_BIN)
df_avlt$APOE4_BIN = factor(df_avlt$APOE4_BIN)
df_wmh$APOE4_BIN = factor(df_wmh$APOE4_BIN)
df_av45$APOE4_BIN = factor(df_av45$APOE4_BIN)
df_hcicv$APOE4_BIN = factor(df_hcicv$APOE4_BIN)
df_ef$Gender = factor(df_ef$Gender)
df_mem$Gender = factor(df_mem$Gender)
df_adas$Gender = factor(df_adas$Gender)
df_avlt$Gender = factor(df_avlt$Gender)
df_wmh$Gender = factor(df_wmh$Gender)
df_av45$Gender = factor(df_av45$Gender)
df_hcicv$Gender = factor(df_hcicv$Gender)
# Only keep N/SMC/EMCI/LMCI
valid_diags = c('N','SMC','EMCI','LMCI')
#valid_diags = c('EMCI','LMCI')
#valid_diags = c('N','SMC')
df_mem = df_mem[which(df_mem$diag_prior %in% valid_diags),]
df_ef = df_ef[which(df_ef$diag_prior %in% valid_diags),]
df_avlt = df_avlt[which(df_avlt$diag_prior %in% valid_diags),]
df_adas = df_adas[which(df_adas$diag_prior %in% valid_diags),]
df_wmh = df_wmh[which(df_wmh$diag_prior %in% valid_diags),]
df_av45 = df_av45[which(df_av45$diag_prior %in% valid_diags),]
df_hcicv = df_hcicv[which(df_hcicv$diag_prior %in% valid_diags),]
df_av45 = read.csv('dpgmm_alpha15.37_bilateral_AV45_ALL_longdata_continuous_slope.csv')
df_av45$CORTICAL_SUMMARY_POSITIVE = factor(df_av45$CORTICAL_SUMMARY_POSITIVE)
df_av45$RID = factor(df_av45$RID)
df_av45$group = factor(df_av45$group)
df_av45$diag_prior = factor(df_av45$diag_prior)
df_av45$APOE4_BIN = factor(df_av45$APOE4_BIN)
df_av45$Gender = factor(df_av45$Gender)
valid_diags = c('N','SMC','EMCI','LMCI')
#valid_diags = c('EMCI','LMCI')
#valid_diags = c('N','SMC')
df_av45 = df_av45[which(df_av45$diag_prior %in% valid_diags),]
fm_av45 = lm(AV45_slope ~ diag_prior + poly(CORTICAL_SUMMARY_prior,2) + X1 + X4 + X22 + X25 + X5 + X3 + X6 + X9 + X0 + X34 + X2 + X19 + X29 + X56 + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs, df_av45)
fm_av45 = lm(AV45_slope ~ diag_prior + poly(CORTICAL_SUMMARY_prior,2) + X1 + X4 + X22 + X25 + X5 + X3 + X6 + X9 + X0 + X34 + X2 + X19 + X29 + X56 + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
fm_av45
summary(fm_av45)
coef(fm_av45)
fm_av45$df.residual
fm_av45$contrasts
anova(fm_av45)
plot.lm(fm_av45)
abline(fm_av45)
plot.new
plot.new()
abline(fm_av45)
plot(CORTICAL_SUMMARY_prior, AV45_slope)
plot(CORTICAL_SUMMARY_prior, AV45_slope, data=df_av45)
df_av45['CORTICAL_SUMMARY_prior']
plot(df_av45['CORTICAL_SUMMARY_prior'],df_av45['AV45_slope'])
lines(predict(fm_av45))
predict(av45)
predict(fm_av45)
df_av45['CORTICAL_SUMMARY_prior',]
df_av45[,'CORTICAL_SUMMARY_prior']
plot(df_av45[,'CORTICAL_SUMMARY_prior'],predict(fm_av45))
plot(df_av45[,'CORTICAL_SUMMARY_prior'],df_av45[,'AV45_slope'])
fm_av45_nopattern = lm(AV45_slope ~ diag_prior + poly(CORTICAL_SUMMARY_prior,2) + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
fm_av45 = lm(AV45_slope ~ diag_prior + poly(CORTICAL_SUMMARY_prior,2) + X1 + X4 + X22 + X25 + X5 + X3 + X6 + X9 + X0 + X34 + X2 + X19 + X29 + X56 + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
summary(fm_av45_nopattern)
summary(fm_av45)
anova(fm_av45_nopattern,fm_av45)
plot(df_av45[,'CORTICAL_SUMMARY_prior'],predict(fm_av45_nopattern))
fm_av45_nopattern_lme = lm(AV45_slope ~ diag_prior + poly(CORTICAL_SUMMARY_prior,2) + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs. + (1|RID), df_av45)
fm_av45_lme = lm(AV45_slope ~ diag_prior + poly(CORTICAL_SUMMARY_prior,2) + X1 + X4 + X22 + X25 + X5 + X3 + X6 + X9 + X0 + X34 + X2 + X19 + X29 + X56 + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs. + (1|RID), df_av45)
fm_av45_nopattern_lme = lmer(AV45_slope ~ diag_prior + poly(CORTICAL_SUMMARY_prior,2) + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs. + (1|RID), df_av45)
fm_av45_lme = lmer(AV45_slope ~ diag_prior + poly(CORTICAL_SUMMARY_prior,2) + X1 + X4 + X22 + X25 + X5 + X3 + X6 + X9 + X0 + X34 + X2 + X19 + X29 + X56 + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs. + (1|RID), df_av45)
bartlett.test(df_av45)
bartlett.test(df_av45,group)
bartlett.test(df_av45[,'AV45_slope'],group[,'group'])
bartlett.test(df_av45[,'AV45_slope'],df_av45[,'group'])
qchisq(0.95,3)
qchisq(0.95,13)
fligner.test(df_av45[,'AV45_slope'],df_av45[,'group'])
fm_av45_spline = lm(AV45_slope ~ diag_prior + ns(CORTICAL_SUMMARY_prior,knot=1.2813) + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
library(splines)
fm_av45_spline = lm(AV45_slope ~ diag_prior + ns(CORTICAL_SUMMARY_prior,knot=1.2813) + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
summary(fm_av45_spline)
summary(fm_av45_nopattern)
fm_av45_spline = lm(AV45_slope ~ diag_prior + ns(CORTICAL_SUMMARY_prior,knot=1.2813) + X1 + X4 + X22 + X25 + X5 + X3 + X6 + X9 + X0 + X34 + X2 + X19 + X29 + X56 + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
summary(fm_av45_spline)
summary(fm_av45)
fm_av45_nopattern_spline = lm(AV45_slope ~ diag_prior + ns(CORTICAL_SUMMARY_prior,df=5) + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
fm_av45_spline = lm(AV45_slope ~ diag_prior + ns(CORTICAL_SUMMARY_prior,df=5) + X1 + X4 + X22 + X25 + X5 + X3 + X6 + X9 + X0 + X34 + X2 + X19 + X29 + X56 + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
summary(fm_av45_spline)
summary(fm_av45_nopattern_spline)
anova(fm_av45_spline)
anova(fm_av45_nopattern_spline)
ns
# LM models
fm_av45_nopattern = lm(AV45_slope ~ diag_prior + poly(CORTICAL_SUMMARY_prior,2) + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
fm_av45 = lm(AV45_slope ~ diag_prior + poly(CORTICAL_SUMMARY_prior,2) + X1 + X4 + X22 + X25 + X5 + X3 + X6 + X9 + X0 + X34 + X2 + X19 + X29 + X56 + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
# splined LM models
fm_av45_nopattern_spline = lm(AV45_slope ~ diag_prior + ns(CORTICAL_SUMMARY_prior,df=5) + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
fm_av45_spline = lm(AV45_slope ~ diag_prior + ns(CORTICAL_SUMMARY_prior,df=5) + X1 + X4 + X22 + X25 + X5 + X3 + X6 + X9 + X0 + X34 + X2 + X19 + X29 + X56 + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
plot(df_av45[,'CORTICAL_SUMMARY_prior'],df_av45[,'AV45_slope'])
plot(df_av45[,'CORTICAL_SUMMARY_prior'],predict(fm_av45))
plot(df_av45[,'CORTICAL_SUMMARY_prior'],predict(fm_av45_nopattern))
plot(df_av45[,'CORTICAL_SUMMARY_prior'],predict(fm_av45_spline))
plot(df_av45[,'CORTICAL_SUMMARY_prior'],predict(fm_av45_nopattern_spline))
fm_av45_nopattern = lm(log(AV45_slope) ~ diag_prior + poly(log(CORTICAL_SUMMARY_prior),2) + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
fm_av45_nopattern = lm(AV45_slope ~ diag_prior + poly(log(CORTICAL_SUMMARY_prior),2) + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
plot(df_av45[,'CORTICAL_SUMMARY_prior'],predict(fm_av45_nopattern))
summary(fm_av45_nopattern)
fm_av45_nopattern = lm(AV45_slope ~ diag_prior + poly(CORTICAL_SUMMARY_prior,2) + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
fm_av45 = lm(AV45_slope ~ diag_prior + poly(CORTICAL_SUMMARY_prior,2) + X1 + X4 + X22 + X25 + X5 + X3 + X6 + X9 + X0 + X34 + X2 + X19 + X29 + X56 + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
# splined LM models
fm_av45_nopattern_spline = lm(AV45_slope ~ diag_prior + ns(CORTICAL_SUMMARY_prior,df=5) + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
fm_av45_spline = lm(AV45_slope ~ diag_prior + ns(CORTICAL_SUMMARY_prior,df=5) + X1 + X4 + X22 + X25 + X5 + X3 + X6 + X9 + X0 + X34 + X2 + X19 + X29 + X56 + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
fm_av45_nopattern_summary = summary(fm_av45_nopattern)
fm_av45_summary = summary(fm_av45)
fm_av45_nopattern_spline_summary = summary(fm_av45_nopattern_spline)
fm_av45_spline_summary = summary(fm_av45_spline)
fm_av45_nopattern_summary$r.squared
fm_av45_nopattern_summary$r.squared
fm_av45_summary$r.squared
fm_av45_nopattern_spline_summary$r.squared
fm_av45_spline_summary$r.squared
fm_modelcomparison_anova = anova(fm_av45_nopattern_spline, fm_av45_spline)
fm_modelcomparison_anova
coef(fm_av45_spline)
fm_av45_spline_summary$coefficients
row.names(fm_av45_spline_summary$coefficients
)
contrasts_all = read.csv('contrasts_lm.csv')
contrasts_all = read.csv('contrasts_lm.csv')
test = glht(fm_av45_spline,linfct=data.matrix(contrasts_all))
test_summary = summary(test)
test_summary
contrasts = test_summary$linfct
coeff = matrix(test_summary$test$coefficients)
colnames(coeff) = 'estimate'
pvalue = matrix(test_summary$test$pvalues)
colnames(pvalue) = 'pvalues'
stderr = matrix(test_summary$test$sigma)
colnames(stderr) = 'stderr'
zvalue = matrix(test_summary$test$tstat)
colnames(zvalue) = 'zvalue'
contrasts = cbind(contrasts,coeff,stderr,zvalue,pvalue)
write.csv(contrasts, file = "av45_splinelm_contrasts.csv", na = "")
plot(df_av45[,'CORTICAL_SUMMARY_prior'],df_av45[,'AV45_slope'], main='Original Data', xlab='Cortical Summary BL', ylab='Annualized AV45 Slope')
plot(df_av45[,'CORTICAL_SUMMARY_prior'],predict(fm_av45), main='LM Predicted (with patterns)', xlab='Cortical Summary BL', ylab='Annualized AV45 Slope')
plot(df_av45[,'CORTICAL_SUMMARY_prior'],predict(fm_av45_nopattern), main='LM Predicted (without patterns)', xlab='Cortical Summary BL', ylab='Annualized AV45 Slope')
plot(df_av45[,'CORTICAL_SUMMARY_prior'],predict(fm_av45_spline), main='Cubic Spline LM Predicted (with patterns)', xlab='Cortical Summary BL', ylab='Annualized AV45 Slope')
plot(df_av45[,'CORTICAL_SUMMARY_prior'],predict(fm_av45_nopattern_spline), main='Cubic Spline LM Predicted (without patterns)', xlab='Cortical Summary BL', ylab='Annualized AV45 Slope')
sink('av45_lm_nopattern.txt'); print(fm_av45_nopattern_summary, correlation=TRUE); sink(file=NULL)
sink('av45_lm_withpattern.txt'); print(fm_av45_summary, correlation=TRUE); sink(file=NULL)
sink('av45_spline_lm_nopattern.txt'); print(fm_av45_nopattern_spline_summary, correlation=TRUE); sink(file=NULL)
sink('av45_spline_lm_withpattern.txt'); print(fm_av45_spline_summary, correlation=TRUE); sink(file=NULL)
sink('av45_lm_nopattern_anova.txt'); print(fm_av45_nopattern_anova, correlation=TRUE); sink(file=NULL)
sink('av45_lm_withpattern_anova.txt'); print(fm_av45_anova, correlation=TRUE); sink(file=NULL)
sink('av45_spline_lm_nopattern_anova.txt'); print(fm_av45_nopattern_spline_anova, correlation=TRUE); sink(file=NULL)
sink('av45_spline_lm_withpattern_anova.txt'); print(fm_av45_spline_anova, correlation=TRUE); sink(file=NULL)
fm_av45_nopattern_anova = anova(fm_av45_nopattern)
fm_av45_anova = anova(fm_av45)
fm_av45_nopattern_spline_anova = anova(fm_av45_nopattern_spline)
fm_av45_spline_anova = anova(fm_av45_spline)
sink('av45_lm_nopattern_anova.txt'); print(fm_av45_nopattern_anova, correlation=TRUE); sink(file=NULL)
sink('av45_lm_withpattern_anova.txt'); print(fm_av45_anova, correlation=TRUE); sink(file=NULL)
sink('av45_spline_lm_nopattern_anova.txt'); print(fm_av45_nopattern_spline_anova, correlation=TRUE); sink(file=NULL)
sink('av45_spline_lm_withpattern_anova.txt'); print(fm_av45_spline_anova, correlation=TRUE); sink(file=NULL)
fm_modelcomparison_anova = anova(fm_av45_nopattern, fm_av45)
fm_modelcomparison_spline_anova = anova(fm_av45_nopattern_spline, fm_av45_spline)
sink('av45_mc_anova.txt'); print(fm_modelcomparison_anova, correlation=TRUE); sink(file=NULL)
sink('av45_spline_mc_anova.txt'); print(fm_modelcomparison_spline_anova, correlation=TRUE); sink(file=NULL)
fm_av45 = lm(AV45_slope ~ diag_prior + X1 + X4 + X22 + X25 + X5 + X3 + X6 + X9 + X0 + X34 + X2 + X19 + X29 + X56 + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
summary(fm_av45)
summary(fm_av45)
fm_av45 = lm(AV45_slope ~ diag_prior + X1 + X4 + X22 + X25 + X5 + X3 + X6 + X9 + X0 + X34 + X2 + X19 + X29 + X56 + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
fm_av45
anova(fm_av45)
fm_av45 = lm(AV45_slope ~ diag_prior + poly(CORTICAL_SUMMARY_prior,2) + X1 + X4 + X22 + X25 + X5 + X3 + X6 + X9 + X0 + X34 + X2 + X19 + X29 + X56 + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
fm_av45
sink()
fm_av45
library(lme4)
library(coefplot2)
library(ggplot2)
library(lmerTest)
library(pbkrtest)
library(multcomp)
library(contrast)
library(xtable)
library(sjPlot)
library(splines)
# Import data for Ns
df_av45 = read.csv('dpgmm_alpha15.37_bilateral_AV45_ALL_longdata_continuous_slope.csv')
df_av45$CORTICAL_SUMMARY_POSITIVE = factor(df_av45$CORTICAL_SUMMARY_POSITIVE)
df_av45$RID = factor(df_av45$RID)
df_av45$group = factor(df_av45$group)
df_av45$diag_prior = factor(df_av45$diag_prior)
df_av45$APOE4_BIN = factor(df_av45$APOE4_BIN)
df_av45$Gender = factor(df_av45$Gender)
# Only keep N/SMC/EMCI/LMCI
valid_diags = c('N','SMC','EMCI','LMCI')
#valid_diags = c('EMCI','LMCI')
#valid_diags = c('N','SMC')
df_av45 = df_av45[which(df_av45$diag_prior %in% valid_diags),]
# PCA on patterns
# LM models
fm_av45_nopattern = lm(AV45_slope ~ diag_prior + poly(CORTICAL_SUMMARY_prior,2) + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
fm_av45 = lm(AV45_slope ~ diag_prior + poly(CORTICAL_SUMMARY_prior,2) + X1 + X4 + X22 + X25 + X5 + X3 + X6 + X9 + X0 + X34 + X2 + X19 + X29 + X56 + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
# splined LM models
fm_av45_nopattern_spline = lm(AV45_slope ~ diag_prior + ns(CORTICAL_SUMMARY_prior,df=5) + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
fm_av45_spline = lm(AV45_slope ~ diag_prior + ns(CORTICAL_SUMMARY_prior,df=5) + X1 + X4 + X22 + X25 + X5 + X3 + X6 + X9 + X0 + X34 + X2 + X19 + X29 + X56 + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
install.packages('sjPlot')
install.packages('xtable')
fm_av45 = lm(AV45_slope ~ diag_prior + X1 + X4 + X22 + X25 + X5 + X3 + X6 + X9 + X0 + X34 + X2 + X19 + X29 + X56 + APOE4_BIN + Age.AV45 + Gender + Edu..Yrs., df_av45)
fm_av45
print(fm_av45)
fm_av45_spline
summary(fm_av45_spline)
sink(file=NULL)
summary(fm_av45_spline)
